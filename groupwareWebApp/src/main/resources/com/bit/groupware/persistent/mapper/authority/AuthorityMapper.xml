<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.bit.groupware.persistent.mapper.authority.AuthorityMapper">

      <resultMap type="RoleVO" id="selectAuthRoleResultMap">      
          <id column="r_id" property="rId"/>
           <result column="r_name" property="rName"/>
          <collection property="authorities" javaType="list" ofType="AuthorityVO" >
             <result column="a_name" property="aName"/>
          </collection>
      </resultMap>
      
      <select id="selectAuthority" resultMap="selectAuthRoleResultMap" statementType="STATEMENT">
         select  t1.r_id, t1.r_name, t3.a_name
      from role t1, authority_role t2, authority t3
      where t1.r_id = t2.r_id  
      and t2.a_no = t3.a_no   
      and t1.r_type = 'url'     
      and t1.ISREGISTRATION = '0'                          
      order by  t3.a_name asc, t1.sort_order asc       
      </select>
      
      
      <resultMap type="UserVO" id="selectEmployeeResultMap">
      	<association property="employee" javaType="EmployeeVO">
      		<result property="empNo" column="emp_no"/>
      		<result property="empName" column="emp_name"/>
      		<result property="emp_pwd" column="empPwd"/>
      		<result property="phone_number" column="phoneNumber"/>
      		<result property="email" column="email"/>
      		<result property="reg_number" column="regNumber"/>
      		<result property="hire_date" column="hireDate"/>
      		<result property="retire_status" column="retireStatus"/>
      		<result property="retire_date" column="retireDate"/>
      		<result property="address" column="address"/>
      		<result property="isAdmin" column="isAdmin"/>
      		
      		<collection property="codes" javaType="list" ofType="CodeVO">
      			<result property="c_no" column="cNo"/>
      			<result property="c_name" column="cName"/>
      			<result property="relation_code" column="relationCode"/>
      		</collection>
      		
      		<collection property="photos" javaType="list" ofType="PhotoVO">
      			<result property="photo_no" column="photoNo" />
      			<result property="photo_name" column="photoName"/>
      			<result property="system_file_name" column="systemFileName"/>
      			<result property="file_size" column="fileSize"/>
      			<result property="division" column="division"/>
      		</collection>
      	</association>
      </resultMap>
      
      <select id="selectEmployee" parameterType="String" resultMap="selectEmployeeResultMap" statementType="PREPARED">
      	<!-- select checkAdmin as isAdmin,emp_no as empNo, emp_name as empName, emp_pwd as empPwd 
      	from employee
      	where emp_no= #{value} -->
      	
      	select e.emp_no, emp_name, emp_pwd, eng_name, phone_number, email,
	        reg_number, hire_date, retire_status, retire_date, address, isAdmin,
	        c.c_no, c_name, relation_code, photo_no, photo_name,system_file_name,file_size,division
		from employee_code ec, employee e, code c, photo ph
		where ec.emp_no = e.emp_no
		    and ec.c_no = c.c_no
	        and e.emp_no = ph.emp_no
	        and e.emp_no = #{empNo}
      </select>
      
      
  
      
      <select id="selectAuthEmp" resultType="string" statementType="PREPARED" parameterType="String">
      	select t3.a_name as aName
      	from authority_employee t1, employee t2, authority t3 
      	where t1.emp_no = t2.emp_no
      	and t1.a_no = t3.a_no
      	and t1.emp_no = #{value}
      </select>
</mapper>